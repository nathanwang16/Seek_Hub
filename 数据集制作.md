# 用于大模型微调的中英文对照书籍数据集构建全流程指南

## 1. 书籍获取与自动下载设计

**目标选书**：根据要求，我们需要获取约100本具备英文原版和中文译本的书籍，涵盖以下类型：人文社科基础教材(~30本，如政治、经济、历史等)、小说(~30本)、科普读物(~30本)和诗歌(~10本)，避免选择数学和物理类书籍。这些书籍的英文原版和官方中文译本都可以在Z-Library等数字图书馆中找到。首先，应确定每个类别下的具体书目清单，优先选择知名且有中译本的书籍（例如，人文类可选《国富论》(英文版 *The Wealth of Nations*)及其中译本，小说类如《1984》《飘》等，中译本通常早已出版）。

**自动下载策略**：Z-Library 是主要来源，但由于其官方网站曾被查封，使用时需要注意镜像或替代方案。推荐的策略如下：

- **使用影子图书馆搜索引擎 (Anna’s Archive)**： ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=%E5%BD%B1%E5%AD%90%E5%9B%BE%E4%B9%A6%E9%A6%86%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E8%83%BD%E6%A3%80%E7%B4%A2%20Z,%E7%BD%91%E7%AB%99%E4%B8%AD%E8%83%BD%E6%A3%80%E7%B4%A2%E5%88%B0%E5%85%A8%E9%83%A8%E5%86%85%E5%AE%B9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%B4%E5%8F%AA%E8%A6%81%E6%9C%89%E8%BF%99%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%8C%E4%B8%8D%E8%AE%BA%E6%98%AF%20SCI%20%E6%96%87%E7%AB%A0%E8%BF%98%E6%98%AF%E4%B9%A6%E7%B1%8D%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E5%BE%88%E5%A5%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E3%80%82))这是一个聚合搜索平台，可以同时检索Z-Library、Library Genesis等影子图书馆资源。该引擎拥有中文界面，支持直接输入中文或英文书名进行检索，无需登录 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=%E5%BD%B1%E5%AD%90%E5%9B%BE%E4%B9%A6%E9%A6%86%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E8%83%BD%E6%A3%80%E7%B4%A2%20Z,%E7%BD%91%E7%AB%99%E4%B8%AD%E8%83%BD%E6%A3%80%E7%B4%A2%E5%88%B0%E5%85%A8%E9%83%A8%E5%86%85%E5%AE%B9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%B4%E5%8F%AA%E8%A6%81%E6%9C%89%E8%BF%99%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%8C%E4%B8%8D%E8%AE%BA%E6%98%AF%20SCI%20%E6%96%87%E7%AB%A0%E8%BF%98%E6%98%AF%E4%B9%A6%E7%B1%8D%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E5%BE%88%E5%A5%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E3%80%82))。通过它，可以方便地找到某本书的多种语言版本。检索结果清晰标注作者、语言、出版年份、文件格式等信息，支持按语言或文件格式筛选 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=%E5%BD%B1%E5%AD%90%E5%9B%BE%E4%B9%A6%E9%A6%86%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E8%83%BD%E6%A3%80%E7%B4%A2%20Z,%E7%BD%91%E7%AB%99%E4%B8%AD%E8%83%BD%E6%A3%80%E7%B4%A2%E5%88%B0%E5%85%A8%E9%83%A8%E5%86%85%E5%AE%B9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%B4%E5%8F%AA%E8%A6%81%E6%9C%89%E8%BF%99%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%8C%E4%B8%8D%E8%AE%BA%E6%98%AF%20SCI%20%E6%96%87%E7%AB%A0%E8%BF%98%E6%98%AF%E4%B9%A6%E7%B1%8D%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E5%BE%88%E5%A5%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E3%80%82))。利用此引擎，我们可以先搜索英文书名，找到英文版下载链接；再用中文书名或作者搜索对应的中文版。 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=%E5%AF%B9%E4%BA%8E%E4%B8%80%E4%BA%9B%E4%B8%AD%E6%96%87%E4%B9%A6%E7%B1%8D%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E6%A3%80%E7%B4%A2%E4%B9%A6%E5%90%8D%E5%B0%9D%E8%AF%95%E8%BF%9B%E8%A1%8C%E4%B8%8B%E8%BD%BD%E3%80%82%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E6%97%A0%E9%9C%80%E7%99%BB%E5%BD%95%E6%88%96%E8%80%85%E6%B3%A8%E5%86%8C%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%9C%A8%E6%A3%80%E7%B4%A2%E6%A1%86%E4%B8%AD%E8%BE%93%E5%85%A5%E9%A2%98%E7%9B%AE%E7%AD%89%E4%BF%A1%E6%81%AF%E5%8D%B3%E5%8F%AF%E6%A3%80%E7%B4%A2%E3%80%82))
- **使用 zlib.app 镜像站**： ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=Z,Library%20%E6%90%AD%E5%BB%BA%E4%B8%AD%E8%BD%AC%E8%B4%A6%E5%8F%B7%E5%88%9B%E5%BB%BA%E4%BA%86%20zlib.app%E3%80%82))这是国内爱好者搭建的Z-Library Web端接口，相当于将Z-Library的App移植到网页上 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=Z,Library%20%E6%90%AD%E5%BB%BA%E4%B8%AD%E8%BD%AC%E8%B4%A6%E5%8F%B7%E5%88%9B%E5%BB%BA%E4%BA%86%20zlib.app%E3%80%82))。zlib.app 界面简单，无需复杂操作，检索方式与原Z-Library相同，支持中英文关键字输入 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=zlib.app%20%E7%9A%84%E4%BD%BF%E7%94%A8%E7%95%8C%E9%9D%A2%E6%9E%81%E5%85%B6%E7%AE%80%E5%8D%95%EF%BC%8C%E5%8F%AA%E6%9C%89%E5%87%A0%E4%B8%AA%E5%AD%97%E5%92%8C%E6%A3%80%E7%B4%A2%E6%A1%86%EF%BC%8C%E5%87%A0%E4%B9%8E%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E4%BD%BF%E7%94%A8%E9%9A%BE%E5%BA%A6%EF%BC%8C%E6%A3%80%E7%B4%A2%E6%97%B6%E4%B8%8E%20Z))。通过zlib.app，可以高效搜索所需书籍并直接下载 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=zlib.app%20%E7%9A%84%E4%BD%BF%E7%94%A8%E7%95%8C%E9%9D%A2%E6%9E%81%E5%85%B6%E7%AE%80%E5%8D%95%EF%BC%8C%E5%8F%AA%E6%9C%89%E5%87%A0%E4%B8%AA%E5%AD%97%E5%92%8C%E6%A3%80%E7%B4%A2%E6%A1%86%EF%BC%8C%E5%87%A0%E4%B9%8E%E6%B2%A1%E6%9C%89%E4%BB%BB%E4%BD%95%E4%BD%BF%E7%94%A8%E9%9A%BE%E5%BA%A6%EF%BC%8C%E6%A3%80%E7%B4%A2%E6%97%B6%E4%B8%8E%20Z))。使用它可以避免自己写爬虫处理复杂的登录流程。但需要注意镜像站的稳定性，下载时可能有并发或流量限制。
- **使用Z-Library非官方API或脚本**：如果需要批量化、可编程地下载，推荐使用现有的非官方Python库或API。例如 **zlibrary** Python库 ([zlibrary · PyPI](https://pypi.org/project/zlibrary/#:~:text=lib%20%3D%20zlibrary.AsyncZlib%28%29%20,login%28email%2C%20password))可通过“单点登录”账户访问Z-Library，支持程序化登录、搜索和下载。使用该库时，需要先注册Z-Library的个人账户（Singlelogin），获取专属域名或凭证。登录成功后，可以用API搜索书名（可指定语言）并获取下载链接 ([zlibrary · PyPI](https://pypi.org/project/zlibrary/#:~:text=lib%20%3D%20zlibrary.AsyncZlib%28%29%20,login%28email%2C%20password))。类似地，GitHub上也有项目（如 **Z-Library** by Advik-B）提供同步接口，可按书名或ISBN搜索并下载 ([Advik-B/Z-Library - GitHub](https://github.com/Advik-B/z-library#:~:text=Advik,programmatically%20search%20for%20books%2C))。利用这些工具编写脚本循环处理书目清单，可实现批量下载。注意控制下载频率，以避免触发网站的限流或账户冻结。
- **下载流程**：无论采用何种方式，推荐的流程是**“先搜索，后下载”**。针对每本目标书：

  1. **英文版获取**：以英文书名或ISBN为关键字搜索，限定语言为English，从结果中确定正确的书（根据作者、出版年匹配）。记录其下载链接或ID。
  2. **中文版获取**：以中文书名或作者为关键字搜索，或在英文版详情中查找是否有其他语言版本。Z-Library的记录有时包含多语言版本信息或译者名，可辅助确认。 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=%E5%BD%B1%E5%AD%90%E5%9B%BE%E4%B9%A6%E9%A6%86%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E8%83%BD%E6%A3%80%E7%B4%A2%20Z,%E7%BD%91%E7%AB%99%E4%B8%AD%E8%83%BD%E6%A3%80%E7%B4%A2%E5%88%B0%E5%85%A8%E9%83%A8%E5%86%85%E5%AE%B9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%B4%E5%8F%AA%E8%A6%81%E6%9C%89%E8%BF%99%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%8C%E4%B8%8D%E8%AE%BA%E6%98%AF%20SCI%20%E6%96%87%E7%AB%A0%E8%BF%98%E6%98%AF%E4%B9%A6%E7%B1%8D%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E5%BE%88%E5%A5%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E3%80%82))如果直接搜索不到，可在豆瓣等网站查询该书的中译名，再在Z-Library搜索中文书名。
  3. **批量下载**：将英文版和对应中文版的下载链接存入列表，使用下载工具批量下载。如需登录验证，确保脚本携带登录cookie或使用API自带的下载方法。**下载格式**以PDF和EPUB居多 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=%E7%BB%8F%E7%AC%94%E8%80%85%E6%B5%8B%E8%AF%95%EF%BC%8C%E4%B8%8B%E8%BD%BD%E7%9A%84%E4%B9%A6%E7%B1%8D%E4%B8%BB%E8%A6%81%E6%9D%A5%E8%87%AA%E7%B4%A2%20Z,%E7%9A%84%E7%94%B5%E5%AD%90%E4%B9%A6%E6%A0%BC%E5%BC%8F%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%BD%AC%E6%8D%A2%20pdf%20%E7%9A%84%E7%BD%91%E7%AB%99%E5%8D%B3%E5%8F%AF%E8%BD%AC%E5%8C%96%E6%88%90%20pdf%20%E6%96%87%E4%BB%B6%E3%80%82))（最好优先下载EPUB或带文本的PDF，以方便后续提取文本）。

**账号与权限**：需要注意Z-Library对未登录用户的限制（单日下载次数等）。使用个人账户登录可提高下载配额。建议申请多个账号以防单账号限制，或错开时间段批量下载。确保网络稳定，可使用代理/VPN（如有地理封锁）。下载过程中请遵守目标网站的机器人协议，设置合理的爬取延时，避免过于频繁的请求导致IP被封禁。

**推荐搜索策略**：在人文、科普等类别下，优先搜索知名度高且确定有官方中译本的书籍。例如：

- *人文社科教材*: 搜索关键领域的经典教材或入门读物（使用英文标题或主题关键词），如“Introduction to Political Science”、“World History: An Overview”等，结合作者名确保准确匹配。
- *小说*: 可参考著名文学作品名单，搜索英文原名（如“Pride and Prejudice”、“To Kill a Mockingbird”等），确认有对应的中文译名。
- *科普*: 搜索常见科普畅销书（如“Sapiens: A Brief History of Humankind”，中文《人类简史》；“The Selfish Gene”，中文《自私的基因》等）。
- *诗歌*: 搜索英文诗集（如“T.S. Eliot Collected Poems”或经典长诗如“The Odyssey”等）并确认译本。诗歌可能需要注意译本版本统一。

通过上述策略获取的英文和中文电子书文件，将用于后续的文本转换与对齐处理。

## 2. 中英文版本匹配与筛选

**匹配原则**：为了保证英文段落能找到准确对应的中文翻译，必须确保我们下载的中英文文件确为同一本书的内容。一些匹配技巧包括：

- **元数据比对**：利用书籍的元数据（作者、书名、副标题、出版年份等）来确认。英文原著与中文译著通常共享作者姓名（译本通常会列出原作者），出版年份也应对应合理范围。如果英文原书和中文书的作者字段一致（或中文译本标注了相应英文作者），基本可确认匹配。ISBN无法直接匹配不同语种版本，但可以通过ISBN查询图书条目，比对原著标题和译著标题是否对应。
- **标题和译名**：有些中文译本的书名并非英文直译，需要通过查找译名对应关系来确认。例如通过中文维基百科或豆瓣读取该书的“原作名”字段。可以半自动化该过程：将英文书名发起中文搜索，如果出现维基百科/豆瓣条目，提取其中的中文书名或译名，再用此名称搜索Z-Library。反之，若先有中文书名，也可查找英文原名。 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=%E5%BD%B1%E5%AD%90%E5%9B%BE%E4%B9%A6%E9%A6%86%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E8%83%BD%E6%A3%80%E7%B4%A2%20Z,%E7%BD%91%E7%AB%99%E4%B8%AD%E8%83%BD%E6%A3%80%E7%B4%A2%E5%88%B0%E5%85%A8%E9%83%A8%E5%86%85%E5%AE%B9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%B4%E5%8F%AA%E8%A6%81%E6%9C%89%E8%BF%99%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%8C%E4%B8%8D%E8%AE%BA%E6%98%AF%20SCI%20%E6%96%87%E7%AB%A0%E8%BF%98%E6%98%AF%E4%B9%A6%E7%B1%8D%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E5%BE%88%E5%A5%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E3%80%82))
- **内容核验**：在下载后，可通过抽取章节标题或正文的一些独特片段进行交叉验证。例如，取英文版第一章开头一句，在中文译本全文中搜索该句对应的译文（或其关键词）。如果能找到高度相似的句子，则说明这两个文件内容对应。同样，可检查英文版最后一段在中文文件中是否出现对应译文。这样的抽样验证确保没有拿错书或拿错版本。
- **一致性检查**：留意章节结构和目录。大部分译本会保留与原书相同的章节数和名称（可能翻译了章节名）。可以从英文和中文PDF中提取目录页，比对章节序号和标题。如果章节数量对不上，可能译本有删节或并章，需要谨慎使用。另外，译者前言或出版社附加内容在中文本可能有，这部分在英文版没有，需要在对齐时排除。

通过以上步骤筛选后，得到**一一对应**的英文书籍及其中文译本文件列表（数量约100对）。建议将对应关系记录在一个清单（如CSV/表格）中，包括字段：英文书名、中文书名、作者、出版年、文件名路径等，方便后续处理时引用。

## 3. 文件格式转换与预处理

拿到英文和中文的电子书文件后，需要将其内容提取为纯文本，以便分段和对齐处理。常见的电子书格式有PDF和EPUB（另外可能有少量MOBI、DJVU等）。针对不同格式，采取相应转换策略：

- **PDF 转换为TXT**：如果PDF是文本层可选取的（不是纯扫描图片），可使用提取工具将文字导出：

  - 推荐使用 **Poppler** 库的 `pdftotext` 工具，命令例如：`pdftotext -layout input.pdf output.txt`。`-layout`参数可尽量保留原段落布局，避免误合并段落。
  - 或使用 Python 的 **PyMuPDF** (`fitz`) 库脚本遍历PDF页提取文字，直接输出UTF-8文本。
  - **注意**：部分PDF可能包含扫描的图片（特别是老旧中文译本）。对此，需要先OCR识别。可使用 **Tesseract OCR** 搭配中文训练数据，对扫描页批量识别，转换为文本。但OCR会引入识别错误，需要后续校对。
  - 提取后检查文本文件头尾是否有乱码或扫描水印，酌情清理。
- **EPUB 转换为TXT**：EPUB实际上是HTML/XML文件的压缩包：

  - 可以使用 **Calibre** 提供的命令行转换工具，如：`ebook-convert book.epub book.txt`，直接得到纯文本 ([How can I convert .epub files to plain text? - Ask Ubuntu](https://askubuntu.com/questions/102458/how-can-i-convert-epub-files-to-plain-text#:~:text=If%20you%27ve%20installed%20calibre%20on,convert%20.%20%E2%80%93%20funroll))。Calibre转换通常会处理章节合并和特殊字符转义。
  - 或使用 **Pandoc** 工具：`pandoc -f epub -t plain -o output.txt input.epub`，能够快速抽取epub中的纯正文文本 ([Convert EPUB to TXT and preserve original formatting](https://unix.stackexchange.com/questions/647686/convert-epub-to-txt-and-preserve-original-formatting#:~:text=formatting%20unix,this%20with%20a%20python))。
  - 也可手动解压 `.epub`（改后缀为zip解压）然后提取里面的 `content.xhtml`等文件，再用正则或脚本剔除HTML标签，保留文本。但这需要处理章节拼接和编码统一，不如直接用现成工具可靠。
- **其他格式**：少量MOBI可以先用Calibre转换为EPUB或TXT。DJVU若出现需要转PDF再OCR。确保所有文字编码统一为UTF-8。

**统一预处理**：转换得到的中英文txt文件，可能仍含有一些杂质和格式问题，需要初步清洗：

- **删除分页符与页眉页脚**：扫描版PDF经OCR后常留下页码或页眉文字（如书名/章节名反复出现）。可编写脚本检测并去除这些模式化内容（例如如果一行仅有数字或形如“第x页”，删除之）。
- **合并断行**：确保段落内没有多余的换行符。许多PDF每行末有换行，需要将连续行合并成完整段落。例如可以基于双语对齐的需要，先在英文文本中根据段落缩进或空行分段，在中文文本中也按相应标记分段。消除因为换行导致的单词拆分（英文中如有 “hy- phenation”跨行，需合并成“hyphenation”）。
- **清除特殊符号**：去除版权声明、扫描噪声字符等非正文内容。保留必要的标点符号。英文文本保留原始标点格式，中文文本则保留全角中文标点符号。**注意**不要误删中文句末的句号“。”等。
- **分章存储**（可选）：为了方便对齐校对，可以考虑先按章或节将文本拆分存为小文件。例如每本书英文Chapter1.txt 对应中文Chapter1.txt。这有助于减小对齐难度（对齐程序可假定章内顺序对应）。

经过格式转换和初步清洗后，我们获得了一对一对应的纯文本文件（英文A.txt 对应中文A.txt等）。这些文本中保留了段落结构，但尚未逐句/段对齐。下一步将对文本内容进行双语对齐。

## 4. 双语段落自动对齐策略

**对齐目标**：将每本书的英文文本按内容顺序切分成段落片段（每段英文约8k字符长度），并找到对应的中文译文段落，形成(英文段, 中文段)对。其中每段应保持语义完整，对应译文准确。

**切分粒度**：8k字符约相当于几页纸的英文内容。直接以固定长度切分可能打断语义或句子。因此，通常先按**自然段落或章节**对齐，然后再组合小段为接近8k字符的大段：

- 先将英文和中文文本均按段落（通过空行或段落缩进识别）分割成句子或小段列表。
- 使用自动对齐算法将英文和中文的小段进行**句段级别**对应匹配，然后再将连续匹配的若干段合并，直到英文部分接近8k字符为一段对。 ([Evaluating automatic sentence alignment approaches on English-Slovak sentences | Scientific Reports](https://www.nature.com/articles/s41598-023-47479-w#:~:text=Sentence%20alignment%20is%20the%20task,sentence%20alignments%20were%201%20to1)) ([Evaluating automatic sentence alignment approaches on English-Slovak sentences | Scientific Reports](https://www.nature.com/articles/s41598-023-47479-w#:~:text=Sentence,NMT%29%2041))

**自动对齐工具**：常见的双语文本对齐算法分为基于长度、基于词典/词汇、以及基于翻译模型的多种方法 ([Evaluating automatic sentence alignment approaches on English-Slovak sentences | Scientific Reports](https://www.nature.com/articles/s41598-023-47479-w#:~:text=resulted%20in%20the%20proposal%20of,The%20length))。鉴于中英差异较大以及文学译文可能存在增减句情况，推荐使用**混合型或语义型对齐**工具：

- **Hunalign 对齐工具**：Hunalign是经典的统计对齐工具，利用句长和双语词典进行句子级对齐 ([mtuoc/MTUOC-aligner: Scripts and programs to ... - GitHub](https://github.com/mtuoc/MTUOC-aligner#:~:text=This%20repository%20offers%20a%20series,alignment%20using%20Hunalign%20or%20SBERT))。可在对英文和中文文本进行句子切分后，使用Hunalign自动输出句子对应关系。为了提升效果，可以提供一个英<->中小型词典给Hunalign参考。Hunalign假设原文译文句子顺序基本一致，对一般书籍适用。但若译者有拆分或合并句子的情况，Hunalign可能输出1对多或跳对的结果，需要人工调整。
- **基于嵌入的对齐**：利用预训练的**多语句向量**模型（如LASER、LaBSE或多语BERT嵌入）计算每个英文句子与中文句子的相似度，然后用动态规划算法找出最佳匹配序列。这类方法对翻译不直译的情况更鲁棒。开源实现如 *Bertalign* 或 *Vecalign* 等，可以生成更精确的句子对齐 ([GitHub - mtuoc/MTUOC-aligner: Scripts and programs to automatically align text files using Hunalign or SBERT.](https://github.com/mtuoc/MTUOC-aligner#:~:text=Scripts%20and%20programs%20to%20automatically,13039%2F501100011033%20%2F%20FEDER%2C%20UE))。它们原理是将句子编码成向量，根据语义相似度匹配，能应对句式差异。缺点是需要一定算力计算嵌入，但100本书规模是可行的。
- **现成对齐软件**：如 **LF Aligner**（基于Hunalign的GUI工具）或 **ABBYY Align**（商业软件）等，可半自动对齐文本。LF Aligner能自动对齐并生成翻译记忆(TMX)等格式。但由于我们数据量较大，全自动流程更理想。

**对齐过程**：可以采用以下步骤实现自动对齐：

1. **句子切分**：将英文、中文TXT用分句工具切开。英文可以按标点符号(. ? !)分句；中文按句号（。）、问号、感叹号等分句。切分时保留句末标点以提高对齐准确率。
2. **算法对齐**：使用上述工具之一对句子列表进行自动匹配，对输出的句对进行简单过滤（去除异常对齐如一侧句子过长另一侧很短可能是错误对齐）。
3. **段落合并**：根据需要的段落长度，将连续的句子对按照原文顺序合并为大段。例如大致每10-15句英语合并为一段，检查合并后英文长度接近8k字符。中文对应段则是相应合并的句子。确保合并边界在对应文本中位置相近，不跨章节或大段落，以保证语义连贯。
4. **结果验证**：随机抽取几段，人工核对英文段和中文段内容是否真正对应。重点查看开头结尾句是否匹配，以防漏对或串段。 ([Evaluating automatic sentence alignment approaches on English-Slovak sentences | Scientific Reports](https://www.nature.com/articles/s41598-023-47479-w#:~:text=statistical%20MT%20performance15,NMT%2916))对齐错误会直接影响后续模型训练效果，因此宁可牺牲少许连续性也要保证准确率。

**注意事项**：文学类文本翻译有时存在**一对多**或**多对一**的句子对应（译者可能拆句或合句）。对齐算法会将这些情况标记为不规则对齐。可以接受少量一对二的句子合并到同一段内，只要整体段落语义不丢失。诗歌类由于排版和译文可能不是逐字对应，自动对齐困难较大，可能需要人工校对段落对应关系（如逐首诗对应）。在输出数据对时，可以以诗为单位作为段落，而不是硬按字符长度切分。

总之，通过结合长度和语义的自动对齐，我们能较高精度地得到英文段落和对应中文段落的映射关系。在这一步完成后，每本书将形成若干(英段,中段)对，这些对将汇总形成最终的数据集。

## 5. 依然是数据清洗与格式化

获得初步对齐的双语段落对后，需要进一步清洗和统一格式，确保成为高质量训练数据：

- **内容完整性检查**：遍历每对(英文段,中文段)，确保中文段是英文段的完整翻译，没有缺句漏句。例如英文段以“This chapter discusses…”开头，中文段应有对应提及“本章讨论…”。如发现译文段落缺少某句内容，可能是对齐错位或译文删减，应标记此对以便人工检查或剔除。
- **消除残留杂质**：确保段落对中不含无关字符。例如某些OCR造成的错字需修正，中英文引号、破折号等符号匹配统一。删除段落开头结尾多余的空白、换行符。中文段落若有译者注释、括号内的额外说明，视任务需求决定保留或去掉。
- **对齐标记与段落顺序**：在生成最终txt时，可以在每条数据对中明确标识语言，或采用固定顺序（如一行英文后一行中文）。简单可靠的格式是每对作为独立的段落块，英文在前，中文在后，用特殊分隔符或换行区分。例如：

  ```
  <EN> It was the best of times, it was the worst of times...  
  <ZH> 这是一个最好的时代，也是一个最坏的时代……  

  <EN> (next English segment)...  
  <ZH> (对应中文段)...  
  ```

  或者更简洁地，直接英文段落和中文段落成对出现，中间以制表符或特殊分隔符隔开也可以。如果输出为JSON或CSV，注意对特殊字符转义。
- **字符编码**：统一使用UTF-8编码存储文本，确保中文不乱码。可以在输出文件开头注明编码或保存为UTF-8 BOM格式以便某些工具识别。
- **长度控制**：英文段落长度约8k字符的要求已经在对齐阶段考虑，但最终输出时再次检查长度。如有段落明显超过8k，应再细分；过短的段落可以视情况与相邻段落合并（同时合并其译文），以保持段落大小均衡。
- **排序和编号**：可以按原书章节顺序输出段落对。为防混淆，可以在每对数据前加一个ID，例如文件名+段号，方便将来溯源。例如前述格式加上ID：`Book01_Paragraph001 <EN> ... <ZH> ...`。这样即使顺序乱了也能重建。

**输出示例**：最终输出可以是一个或多个文本文件。比如每本书一个文件，里面按顺序列出该书的多个双语段落对；或者将所有对混合在一个大文件用于训练。如果每对占两行（英文、中文），各对之间空一行，可以方便模型或脚本逐条读取。**务必保留数据对的顺序对应关系**，不要只输出纯中文或纯英文内容。

在生成最终数据集之前，建议对整个集合做一次**全局检查**：统计一下总段落对数、总字数，抽样几对人工阅读，确保英译文意思相符且没有敏感或违规内容。如果书籍内容包含敏感政治/宗教等，视项目要求决定是否过滤，以免影响下游应用。

## 6. 潜在风险与规避措施

构建此数据集过程中可能遇到以下风险和挑战，并可采取相应措施规避：

- **法律及伦理风险**：通过Z-Library下载受版权保护的书籍可能涉及法律问题。建议确保此用途仅用于研究训练且不公开散布数据集，以遵循“公平使用”原则。如果可能，优先选取版权已过期的文学作品（如19世纪以前经典）或开放许可的教材，以降低侵权风险。**规避措施**：严格限定数据集内部使用，必要时寻求版权授权或用公有领域文本替代部分书籍。
- **网站访问和账号风险**：批量下载可能触发Z-Library反爬虫机制或导致账号封禁。**规避措施**：使用官方推荐的渠道如单用户专属域名，避免频繁更换IP导致异常。控制下载速率，每次下载间隔几秒以上。准备备用账号/镜像源，一旦主要来源失效可及时切换（例如LibGen作为备用）。同时留意Z-Library社区公告，使用其最新可用域名或服务以确保顺利下载。
- **数据质量风险**：包括OCR错误、对齐错误等。如果OCR识别错误率高，译文会有错别字或乱码，影响训练效果。**规避措施**：尽量获取文字版电子书（EPUB/MOBI等）以减少OCR使用。如不得不OCR，可选高精度模型并人工检查关键段落纠错。对齐错误则可能导致英文与中文不对应，这对训练是有害的 ([Evaluating automatic sentence alignment approaches on English-Slovak sentences | Scientific Reports](https://www.nature.com/articles/s41598-023-47479-w#:~:text=statistical%20MT%20performance15,NMT%2916))。**规避措施**：采用先进对齐算法并人工抽查。特别对长度差异悬殊的段落对要重点核验，必要时剔除可疑对齐结果。
- **内容差异风险**：部分译本可能不完全忠实原文，存在增删内容。例如中文版出于审校可能删除某些段落。**规避措施**：在对齐时如果发现某章节大量无法匹配，需要确认是否译本缺失内容。对于缺失的部分，可以选择放弃该段落的对齐（不强制拼凑）。确保最终数据集中每对都是内容完整的一致翻译。
- **格式一致性风险**：跨书籍来源的文本格式不统一，可能影响下游解析。**规避措施**：在清洗阶段统一符号风格。例如统一所有中文引号为中文符号““””，英文引号为英文直引号; 统一年月日格式等等。保持每对数据结构一致，避免混杂不同标记格式。

通过上述流程和措施，我们可以最大程度地确保得到**高质量的中英文对照数据集**。总结来说，关键在于选择可靠的书籍来源、用脚本自动化处理提高效率，同时在人机结合处把控数据质量。最终产出的(英文段落, 中文译文)对将满足长度要求且一一对应，为大模型微调提供良好的训练素材。

**附**：常用工具清单（汇总）：

- **书籍下载**：Anna’s Archive 在线搜索 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=%E5%BD%B1%E5%AD%90%E5%9B%BE%E4%B9%A6%E9%A6%86%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E8%83%BD%E6%A3%80%E7%B4%A2%20Z,%E7%BD%91%E7%AB%99%E4%B8%AD%E8%83%BD%E6%A3%80%E7%B4%A2%E5%88%B0%E5%85%A8%E9%83%A8%E5%86%85%E5%AE%B9%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%B4%E5%8F%AA%E8%A6%81%E6%9C%89%E8%BF%99%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%8C%E4%B8%8D%E8%AE%BA%E6%98%AF%20SCI%20%E6%96%87%E7%AB%A0%E8%BF%98%E6%98%AF%E4%B9%A6%E7%B1%8D%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%83%BD%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0%E5%BE%88%E5%A5%BD%E7%9A%84%E8%A7%A3%E5%86%B3%E3%80%82))、zlib.app 在线下载 ([Z-Library 被封，中英文书籍哪里下？！来看看这份最强攻略-医咖社区](https://www.mediecogroup.com/group/posts/gp_C9hOxbyV#:~:text=Z,Library%20%E6%90%AD%E5%BB%BA%E4%B8%AD%E8%BD%AC%E8%B4%A6%E5%8F%B7%E5%88%9B%E5%BB%BA%E4%BA%86%20zlib.app%E3%80%82))、Z-Library Python API ([zlibrary · PyPI](https://pypi.org/project/zlibrary/#:~:text=lib%20%3D%20zlibrary.AsyncZlib%28%29%20,login%28email%2C%20password))。
- **格式转换**：Calibre `ebook-convert` 将 epub转txt；Poppler `pdftotext` 提取PDF文字；Tesseract OCR 识别扫描文本。
- **文本对齐**：Hunalign 对齐工具（长度+词典） ([mtuoc/MTUOC-aligner: Scripts and programs to ... - GitHub](https://github.com/mtuoc/MTUOC-aligner#:~:text=This%20repository%20offers%20a%20series,alignment%20using%20Hunalign%20or%20SBERT))；BERT嵌入对齐算法（如 Bertalign） ([GitHub - mtuoc/MTUOC-aligner: Scripts and programs to automatically align text files using Hunalign or SBERT.](https://github.com/mtuoc/MTUOC-aligner#:~:text=Scripts%20and%20programs%20to%20automatically,13039%2F501100011033%20%2F%20FEDER%2C%20UE))；LF Aligner 对齐工具（辅助人工校对）。
- **文本清洗**：正则脚本去除噪声；OpenCC 中文繁简转换（如有需要将繁体转简体）。
- **质量验证**：人工抽查对照、统计分析句长比等。

通过以上工具的配合，实现全流程的自动化处理。在执行过程中保持耐心和细致，及时处理异常情况，就能够构建出满足要求的中英文对照书籍数据集，为后续的大模型训练打下坚实基础。
